# Ticket VAL-210: Card Type Detection

## Issue Summary
**Ticket**: VAL-210
**Severity**: High
**Reporter**: Support Team
**Issue**: Valid cards (like Amex, 15 digits) were being rejected by the system.
**Impact**: Loss of revenue and poor user experience for customers with non-standard card lengths.

## Root Cause Analysis
The frontend `components/FundingModal.tsx` enforced a strict 16-digit regex (`/^\d{16}$/`), causing valid 13-19 digit cards (allowed by the backend and general standards) to be blocked before form submission.

## Resolution
Relaxed the frontend validation to match the backend's more robust logic.

### Code Changes:
1.  **Frontend**: Updated `components/FundingModal.tsx` regex to allow 13 to 19 digits:
    ```typescript
    pattern: {
      value: fundingType === "card" ? /^\d{13,19}$/ : /^\d+$/,
      message: "Card number must be 13-19 digits",
    }
    ```

## Verification
A specialized test script `tests/verify-card-type-detection.ts` was created to verify backend acceptance of various card types:
1.  **Visa (16 digit)**: Accepted.
2.  **Amex (15 digit)**: Accepted.
3.  **Diners (14 digit)**: Accepted.
4.  **Invalid Length (12 digit)**: Rejected.
5.  **Invalid Luhn**: Rejected.

## Preventive Measures
1.  **Consistency**: Ensure frontend validation logic matches backend validation logic.
2.  **Standard Compliance**: Use standardized libraries or regex patterns for financial instruments rather than ad-hoc fixed lengths (unless strictly required).
