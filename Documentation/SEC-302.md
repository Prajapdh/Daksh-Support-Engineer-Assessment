# SEC-302: Insecure Random Numbers Report

## Issue Summary
**Ticket**: SEC-302
**Severity**: High
**Issue**: Account numbers were generated using `Math.random()`, which is not cryptographically secure.
**Impact**: Predictable account numbers could allow attackers to enumerate valid accounts, potentially leading to unauthorized access attempts or targeted social engineering.

## Root Cause Analysis
The application used `Math.random()` to generate a 9-digit number for account creation. `Math.random()` is a pseudo-random number generator (PRNG) and its output can be predicted if the internal state is known.
- **File**: `server/routers/account.ts`
- **Code**: `Math.floor(Math.random() * 1000000000)`

## Resolution
We replaced the insecure PRNG with a cryptographically secure pseudo-random number generator (CSPRNG) using Node.js's built-in `crypto` module.

### Changes Implemented
1.  **Secure Random Generation**: Replaced `Math.random()` with `crypto.randomInt()` in `server/routers/account.ts`.
2.  **Verification Script**: Added `tests/verify-secure-random.ts` to ensure the new generator produces valid 10-digit account numbers without immediate collisions or errors.

### Validation
- **Correctness**: Verified that `crypto.randomInt(0, 1000000000)` generates numbers within the correct range.
- **Format**: Confirmed that the output is correctly padded to 10 digits (e.g., `0123456789`).
- **Uniqueness**: Ran a script to generate multiple IDs and confirmed no duplicates in a small sample.

## Preventive Measures
1.  **Linting Rules**: Enforce ESLint rules (e.g., `eslint-plugin-security`) to flag usage of `Math.random()` in security-sensitive contexts.
2.  **Code Reviews**: Mandate review of any PR involving ID generation, token creation, or cryptographic operations.
3.  **Standard Libraries**: Encourage the use of established libraries like `nanoid` or `uuid` for identifier generation instead of custom implementations.
4.  **Developer Education**: Educate the team on the difference between PRNGs and CSPRNGs and when to use each.

## Deployment Instructions
1.  **No Special Actions**: This is a code-level change. Identify if any other parts of the system rely on the seeded nature of `Math.random()` (unlikely for this specific use case).
2.  **Monitor Logs**: Watch for any unexpected errors in account creation, though the `crypto` module is stable and standard in Node.js.
